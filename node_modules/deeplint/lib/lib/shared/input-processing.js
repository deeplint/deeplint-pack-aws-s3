"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applyInputs = exports.processInputs = void 0;
const _ = require("lodash");
const Handlebars = require("handlebars");
const yaml_reader_1 = require("./yaml-reader");
function processInputs(name, inputs, inputsSpec) {
    const res = {};
    if (inputsSpec) {
        Object.keys(inputsSpec).forEach(inputKey => {
            if (inputsSpec) {
                const inputSpec = inputsSpec[inputKey];
                if (inputs && _.has(inputs, inputKey)) {
                    if (inputSpec.type === 'Number') {
                        res[inputKey] = Number(inputs[inputKey]);
                    }
                    else if (inputSpec.type === 'Boolean') {
                        res[inputKey] = Boolean(inputs[inputKey]);
                    }
                    else if (inputSpec.type === 'String') {
                        res[inputKey] = String(inputs[inputKey]);
                    }
                    else {
                        res[inputKey] = inputs[inputKey];
                    }
                }
                else if (_.has(process.env, inputKey)) {
                    res[inputKey] = process.env[inputKey];
                }
                else if (inputSpec.default) {
                    res[inputKey] = inputSpec.default;
                }
                else {
                    throw new Error(`${name} misses required input: ${inputKey}.
                     Description: ${inputSpec.description}`);
                }
            }
        });
    }
    return res;
}
exports.processInputs = processInputs;
function applyInputs(obj, data) {
    const template = Handlebars.compile(yaml_reader_1.default.toString(obj));
    return yaml_reader_1.default.parse(template(data));
}
exports.applyInputs = applyInputs;
