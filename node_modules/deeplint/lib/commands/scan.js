"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const command_1 = require("@oclif/command");
const deeplint_1 = require("../lib/deeplint");
const fs = require("fs");
const figures = require("figures");
const chalk = require("chalk");
const constant_1 = require("../lib/constant");
let Scan = /** @class */ (() => {
    class Scan extends command_1.Command {
        async run() {
            const { flags } = this.parse(Scan);
            try {
                this.log(` ${figures.tick} ${chalk.green.bold('Initializing DeepLint')} \n`);
                const out = flags.out || constant_1.DEFAULT_SNAPSHOT_OUTPUT;
                const deeplint = await deeplint_1.Deeplint.build();
                this.log(` ${figures.tick} ${chalk.green.bold('Retrieving Snapshot')} \n`);
                const snapshots = await deeplint.snap();
                this.log(` ${figures.tick} ${chalk.green.bold('Outputting to ')} ${chalk.blue.bold(out)}\n`);
                fs.writeFileSync(out, JSON.stringify(snapshots));
            }
            catch (error) {
                this.error(error.toString());
            }
        }
    }
    Scan.description = 'Scan resources in the cloud environments and generate snapshot';
    Scan.flags = {
        help: command_1.flags.help({ char: 'h' }),
        // flag with a value (-n, --name=VALUE)
        out: command_1.flags.string({ char: 'o', description: 'snapshot output file' }),
    };
    Scan.args = [];
    return Scan;
})();
exports.default = Scan;
